<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>点击绘制多个不同的点</title>
		<script src="lib/webgl-utils.js"></script>	
		<script src="lib/webgl-debug.js"></script>	
		<script src="lib/cuon-utils.js"></script>	
		<script src="lib/cuon-matrix.js"></script>	
	</head>
	<body onload="main()">
	   <canvas id="pointDemo" width="600" height="400"></canvas>
	   <script type="text/javascript">
			
			//顶点着色程序
			var VSHANER_SOURCE = 
			//attributer uniform 变量
			//attribute vec4 a_Position; 存储限定符 类型 变量名 //vec4(0.0,0.5,0.0,1.0)
			`attribute vec4 a_Position;\n 
			 attribute float a_PointSize;\n
			void main() {\n
			 gl_Position = a_Position;\n
			 gl_PointSize = a_PointSize;\n
			 }\n`;
			//片元
			var FSHADER_SOURCE = 
			` uniform vec4 u_FragColor;\n
			void main() { \n
			 gl_FragColor = u_FragColor;\n
			}\n`;
			function main(){
				var cvs = document.getElementById("pointDemo");
				var gl = getWebGLContext(cvs);//cvs.getContext("webgl")
				if(!gl){
					console.log("not context webgl");
					return 
				}
				if(!initShaders(gl,VSHANER_SOURCE,FSHADER_SOURCE)){
					console.log("Faild");
					return;
				}
				//获取attribute 变量的存储位置
				var a_Position = gl.getAttribLocation(gl.program,"a_Position");
				var a_PointSize = gl.getAttribLocation(gl.program,"a_PointSize");
				var u_FragColor = gl.getUniformLocation(gl.program,"u_FragColor");
				
				if(a_Position < 0){
					console.log("Failed to get a_Position");
					return;
				}
				//指定canvas绘图区域的背景色
				gl.clearColor(0.0,0.0,0.0,1.0); 
				
				cvs.onmousedown = function(ev){
					click(ev,gl,cvs,a_Position,u_FragColor)
				}
				//向对应位置存储数据
				//gl.vertexAttrib3f(a_Position,0.0,0.0,0.0) //vertexAttrib1f
				gl.vertexAttrib1f(a_PointSize,40.0)
			
				//清空
				//gl.clear(gl.COLOR_BUFFER_BIT);
				//gl.drawArrays(gl.POINTS,0,1);
			}
			var g_points = [];
			var g_colors = [];
			
			function click(ev,gl,canvas,a_Position){
				var x = ev.clientX;
				var y = ev.clientY;
				var rect = ev.target.getBoundingClientRect();
				//转化坐标
				x = ((x-rect.left) - canvas.width/2)/(canvas.width/2);
				y = (canvas.height/2 - (y-rect.top))/(canvas.height/2);
				g_points.push([x,y]);
				if(x > 0 && y > 0){
					//g_colors.push()
				} else if(x < 0 && y < 0){
					
				} else{
					
				}
				gl.clear(gl.COLOR_BUFFER_BIT);
				for(var i = 0 ; i < g_points.length ; i++){
					gl.vertexAttrib3f(a_Position,g_points[i][0],g_points[i][1],0.0)
				}
				gl.drawArrays(gl.POINTS,0,1);
			}
			
	   </script>
	</body>
</html>
